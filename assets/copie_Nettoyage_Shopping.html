<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Translitt√©ration OCR</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
#container {
  margin-top: 120px;
  display: flex;
  gap: 10px;
  height: calc(100vh - 200px);
}

/* ‚úÖ Mode horizontal (par d√©faut : textarea √† gauche, tableau √† droite) */
#container.row {
  flex-direction: row;
}

/* ‚úÖ Mode vertical (empil√©) */
#container.column {
  flex-direction: column;
}
  textarea {
    width: 48%;
    height: 400px;
    font-family: monospace;
    font-size: 14px;
    white-space: pre-wrap;
    overflow-wrap: break-word;
  }
  #buttons {
    margin-bottom: 10px;
  }
  button {
    margin-right: 10px;
    padding: 6px 15px;
    font-size: 14px;
  }
  .hidden {
    display: none;
  }
  
/* ‚úÖ Boutons modernis√©s ‚Äî sauf #btnClear */

#buttons button:not(#btnClear) {
  display: flex;
  gap: 10px;
}

#buttons button:not(#btnClear):hover {
  background-color: #0056b3;
}

/* ‚úÖ Textarea visible (OCR brut) */
#inputText {
    background-color: #f9f9f9;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 9px;
    font-family: monospace;
    font-size: 14px;
    line-height: 1.4;
    box-shadow: 9px -8px 3px rgba(0, 0, 0, 0.1);

    margin-top: -60px; /* r√©duit l'espace au-dessus */
}

/* ‚úÖ Table harmonis√©e avec police OCR-friendly */
#previewTable {
  border-collapse: collapse;
  font-family: 'Fira Code', 'JetBrains Mono', Consolas, monospace;
  font-size: 15px;
  margin-left: 10px;
  width: 100%;
}

#previewTable th {
  background-color: #007bff;
  color: white;
  padding: 8px;
  text-align: center;
}

#previewTable td {
  padding: 6px 10px;
  border: 1px solid #ddd;
}
#previewTable td {
  transition: background-color 0.5s ease;
}
#btnClear {
  background-color: #d32f2f;  /* Rouge fonc√© */
  color: white;               /* Texte blanc */
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  font-weight: bold;
  cursor: pointer;
}

#btnClear:hover {
  background-color: #b71c1c;  /* Rouge encore plus fonc√© au survol */
}
#summaryHeader {
  font-weight: bold;
  font-size: 1.1em;
  color: black;
  margin: 0;
  position: absolute;
  top: 10px;   /* distance du haut de la barre */
  right: 15px; /* distance du bord droit */
  background-color:yellow;
}

#resizeControls {
  margin-top: 10px;
  text-align: center;
}

#resizeControls button {
  font-size: 20px;
  padding: 4px 12px;
  margin: 0 5px;
  background-color: #f0f0f0;
  border: 1px solid #bbb;
  border-radius: 4px;
  cursor: pointer;
}

#resizeControls button:hover {
  background-color: #ddd;
}

/* Pour que le container prenne toute la hauteur de la page */
html, body {
  height: 100%;
}

#container {
  height: calc(100vh - 200px); /* Ajustable selon la taille des autres √©l√©ments */
}

textarea, #previewTable {
  height: 100%;
}

#linePreview {
caret-color: black;
  position: absolute;
  top: 0;
  left: 0;
  white-space: pre-wrap;
  font-family: monospace;
  font-size: 14px;
  background: #ffffff;
  padding: 10px;
  border: 1px solid #ccc;
  overflow-y: auto;
  color: black;
  z-index: 999;
  pointer-events: none; /* d√©sactive l'interaction avec la div */
  display: none;
  box-sizing: border-box;
}
#linePreview span.linebreak {
  display: inline-block;
  width: 100%;
  background-color: #ffffcc;
  border-bottom: 1px dashed #999;
}

#fixedBar {
  position: fixed;     /* fix√© en haut */
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;       /* au-dessus du contenu */
  background: white;   /* fond pour lisibilit√© */
  border-bottom: 1px solid #ccc;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
}

#leftZone {
  display: flex;
  flex-direction: column; /* empile les 2 blocs de boutons */
  gap: 10px;
}

#buttons, #resizeControls {
  display: flex;
  gap: 10px;
}

#summaryHeader {
  font-weight: bold;
  font-size: 1.1em;
  margin: 0;
  text-align: right;
}

/* üëá ajuste selon la hauteur r√©elle de ta barre */
#container {
  margin-top: 160px;  /* d√©cale le contenu en dessous de la barre */
}


#buttons button, #resizeControls button {
  margin: 0 4px;             /* petit espace entre boutons */
}

#btnClean,
#verif {
  display: none;
}
</style>
</head>
<body>
<div id="fixedBar">
  <!-- Zone boutons √† gauche -->
  <div id="leftZone">
    <div id="buttons">
      <button id="btnClean">Nettoyer</button>
      <button id="verif" class="hidden">V√©rifier</button>
      <button id="copyresult">Copier</button>
      <button id="btnClear">Effacer</button>
    </div>

    <div id="resizeControls">
	  <button id="leftExpand">
		<img src="left.png" alt="Gauche" style="width:16px; height:16px;">
	  </button>
	  <button id="equalSplit"><img src="center.png" alt="Center" style="width:16px; height:16px;">
	  </button>
	  <button id="rightExpand">
		<img src="right.png" alt="Droite" style="width:16px; height:16px;">
	  </button>
</div>
  </div>

  <!-- R√©sum√© √† droite -->
  <p id="summaryHeader">üßæ Pas de donn√©es</p>
</div>
</br>
<div id="container">
	
  <textarea id="inputText" placeholder="Collez ici vos donn√©es OCR brutes..."></textarea>
  <div id="linePreview"></div>
  
  <table id="previewTable" border="1" cellpadding="6" cellspacing="0" style="border-collapse: collapse; font-family: sans-serif; font-size: 14px;"></table>
  <textarea id="outputText" placeholder="R√©sultat nettoy√©..." class="hidden"></textarea>
</div>

<script>
const textarea = document.getElementById('inputText');
const table = document.getElementById("previewTable");
function removeAccents(str) {
  const remplacements = {
    '√†':'a','√°':'a','√¢':'a','√§':'a','√£':'a','√•':'a',
    '√ß':'c','ƒç':'c','ƒá':'c',
    '√®':'e','√©':'e','√™':'e','√´':'e',
    '√¨':'i','√≠':'i','√Æ':'i','√Ø':'i',
    '√±':'n',
    '√≤':'o','√≥':'o','√¥':'o','√∂':'o','√µ':'o',
    '√π':'u','√∫':'u','√ª':'u','√º':'u',
    '√Ω':'y','√ø':'y',
    '≈°':'s','√ü':'ss','≈æ':'z',
    '≈ì':'oe','√¶':'ae'
  };
  return str.normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .split('')
            .map(c => remplacements[c] || c)
            .join('');
}

function nettoyeur(texte) {
	// traitement special "dm" facture manala an'le chiffre am farany ligne:
	texte = texte.replace(/ [12](?=\r?\n)/g, '');
	//Uniformiser espace si >=4 => atao 6 daholo
	texte = texte.replace(/(\S) {5,}(\S)/g, '$1      $2');  // 6 espaces
	// 2Ô∏è‚É£ Uniformise "x  {2,4}6" ou "X  {2,4}6" ‚Üí "x 6"
	texte = texte.replace(/\b[xX] {2,4}(?=\d)/g, match => match[0] + ' ');
	// 3Ô∏è‚É£ Uniformise "6  {2,4}x" ou "6  {2,4}X" ‚Üí "6 x"
	texte = texte.replace(/(\d) {2,4}[xX]\b/g, '$1 x');
	
 	// Correction : remplacer "   Uus" par " Uus" (plusieurs espaces avant un mot)
	// Remplace tout groupe de 2 espaces ou plus suivi de "Uus" par un espace + "Uus"
	let etape1=texte;
	etape1 = etape1.replace(/ {3}(?=Galut)/g, ' ');
	// Correction : remplacer "Atl.  " par "Atl. " (supprimer espaces multiples apr√®s "Atl.")
	etape1 = etape1.replace(/Atl\.\s{2,}/g, 'Atl. ');
	// üßº √âtape 2 : Remplacer les espaces multiples (>= 2) par un retour √† la ligne
	etape1 = etape1.replace(/ {3,}/g, '\n');
	texte = etape1;
  

  // Supprimer les accents et caract√®res sp√©ciaux
  texte = removeAccents(texte);
 // ‚úÖ üõ†Ô∏è Corrections OCR manuelles connues
  texte = texte
    .replace(/\bKrantonoji\b/gi, 'Kramtomoji')
    .replace(/\bgerinas\b/gi, 'gerimas')
    .replace(/\b0,5681\b/g, '0,568l')
    .replace(/\b0,331\b/g, '0,33l');
	// ** Nettoyage espaces superflus cibl√© **
	// 1) Entre "Gala" et "cena" => exactement 1 espace
	texte = texte.replace(/(Gala) +(?=cena)/g, '$1 ');

	// 2) Entre "Atl." et "Gala" => exactement 1 espace
	texte = texte.replace(/(Atl\.) +(?=Gala)/g, '$1 ');
  let lignes = texte.split(/\r?\n/);
  let result = [];

  // Fonction utilitaire pour tester regex case-insensitive
	const reIgnore = [
	  /nuol.*?-?\d{1,2}[.,]?\d{0,2}.*?galut.*?\d{1,2}[.,]?\d{0,2}/i,
	  /nuol\.\s*-?\d{1,2}[.,]?\d{0,2}\s+galut.*?\d{1,2}[.,]?\d{0,2}/i, // üëà ligne compacte
	  /^ATLAIDES:$/i,
	  /atl.*?-?\d{1,2}[.,]?\d{0,2}.*?cena.*?\d{1,2}[.,]?\d{0,2}/i,
	  /^sie sparen.*/i,
	  /^suteiktos naudos.*/i,
	  /^su acio kortele sutaupete.*/i,
	  /^pritaikytos nuolaidos.*/i,
	  /zu zahlen/i,
	  /^suteiktos nuolaidos:$/i,

	  // üëá Nouveaux ajouts
	  /allah\.\s*-?\d{1,2}[.,]?\d{0,2}\s+uus\s+hind\s+-?\d{1,2}[.,]?\d{0,2}/i,
	  /nu…îl\.\s*-?\d{1,2}[.,]?\d{0,2}\s+galut\.\s*kaina\s+-?\d{1,2}[.,]?\d{0,2}/i,
	  /nuol\.\s*-?\d{1,2}[.,]?\d{0,2}\s+galut\.\s*kaina\s+-?\d{1,2}[.,]?\d{0,2}/i
	];

  for(let ligne of lignes) {
    let l = ligne.trim();


// üî¢ Partie A : Quantit√© (forme avec x ou *)
if (/^.*?\b-?\d{1,3}(?:[.,]\d{1,3})?\b.*?(x|X|\*).*?\b-?\d{1,3}(?:[.,]\d{1,3})?\b.*$/.test(l)) {
  let nombres = l.match(/-?\d{1,3}(?:[.,]\d{1,3})?/g);
  if (nombres && nombres.length >= 2) {
    const originalNombre1 = nombres[0];
    const originalNombre2 = nombres[1];
    let quant = null;

    const lSansEspaces = l.replace(/\s+/g, '');

    // V√©rifie si un nombre est accompagn√© d'une unit√©
    const regexUnite1 = new RegExp(`${originalNombre1.replace(',', '[.,]')}\\s*(kg|vnt|stk|gab|pakele)`, 'i');
    const regexUniteAvant1 = new RegExp(`(kg|vnt|stk|gab|pakele)\\s*${originalNombre1.replace(',', '[.,]')}`, 'i');

    const regexUnite2 = new RegExp(`${originalNombre2.replace(',', '[.,]')}\\s*(kg|vnt|stk|gab|pakele)`, 'i');
    const regexUniteAvant2 = new RegExp(`(kg|vnt|stk|gab|pakele)\\s*${originalNombre2.replace(',', '[.,]')}`, 'i');

    const hasUniteNombre1 = regexUnite1.test(l) || regexUniteAvant1.test(l);
    const hasUniteNombre2 = regexUnite2.test(l) || regexUniteAvant2.test(l);

    // V√©rifie s'il y a un symbole mon√©taire autour du nombre
    const isMonetaire1 = new RegExp(`${originalNombre1.replace(',', '[.,]')}\\s*[‚Ç¨$]`, 'i').test(l) ||
                         new RegExp(`[‚Ç¨$]\\s*${originalNombre1.replace(',', '[.,]')}`, 'i').test(l);
    const isMonetaire2 = new RegExp(`${originalNombre2.replace(',', '[.,]')}\\s*[‚Ç¨$]`, 'i').test(l) ||
                         new RegExp(`[‚Ç¨$]\\s*${originalNombre2.replace(',', '[.,]')}`, 'i').test(l);

    if (hasUniteNombre1 && !isMonetaire1) {
      quant = originalNombre1.replace(',', '.');
    } else if (hasUniteNombre2 && !isMonetaire2) {
      quant = originalNombre2.replace(',', '.');
    } else {
      // Fallback : choisir celui qui n'est pas mon√©taire et qui n'a pas de d√©cimale
      const nb1 = originalNombre1.replace(',', '.');
      const nb2 = originalNombre2.replace(',', '.');

      if (!isMonetaire1 && !nb1.includes('.') && (isMonetaire2 || nb2.includes('.'))) {
        quant = nb1;
      } else if (!isMonetaire2 && !nb2.includes('.') && (isMonetaire1 || nb1.includes('.'))) {
        quant = nb2;
      } else if (!isMonetaire1) {
        quant = nb1;
      } else if (!isMonetaire2) {
        quant = nb2;
      } else {
        // Dernier recours : prendre le premier
        quant = nb1;
      }
    }

    result.push(quant);
    continue;
  }
}

// üß™ Cas sp√©cial : quantit√© unique avec d√©cimale et unit√© (ex: "0,240 kg" ou "0.240 kg")
const matchQuantiteSeule = l.match(/\b(\d{1,3}[,.]\d{1,3})\s*(kg)\b/i);
if (matchQuantiteSeule) {
  const valeur = matchQuantiteSeule[1].replace(',', '.'); // normaliser virgule
  // ‚ö†Ô∏è Exclut si c‚Äôest un entier (ex: "1 kg" ‚Üí non accept√©)
  if (valeur.includes('.')) {
    result.push(valeur);
    continue;
  }
}




	// üí∞ Partie B : Prix (avec formes comme "0,48*B", "2.99A", "-0,99 A", etc.)
	if (/^[\-\+]?\d{1,4}(?:[.,]\d{1,2})?\s*[*]?[A-Z]{1,2}$/.test(l) || /^[\-\+]?\d{1,4}(?:[.,]\d{1,2})[*]?[A-Z]{1,2}$/.test(l)) {
	  let prixStr = l.match(/[\-\+]?\d{1,4}(?:[.,]\d{1,2})/)[0];
	  prixStr = prixStr.replace(',', '.');
	  let prixNum = parseFloat(prixStr);
	  result.push(prixNum.toString());
	  continue;
	}

    // Cas √† Ignorer : on saute la ligne si elle correspond √† un des patterns
    if (reIgnore.some(rx => rx.test(l))) {
      continue;
    }

    // Sinon : produit / texte normal
    result.push(l);
  }

  return result.join('\n');
}

document.getElementById('btnClean').addEventListener('click', () => {
  const input = document.getElementById('inputText').value;

  if (!input.trim()) {
    alert("Veuillez coller du texte dans la zone de gauche.");
    return;
  }

  const output = nettoyeur(input);
  document.getElementById('outputText').value = output;

  // üü° Simuler un clic sur le bouton "Verifier"
  // Cela ex√©cutera le m√™me code que si l'utilisateur cliquait manuellement dessus
  document.getElementById('verif').click();
});

document.getElementById('btnClear').addEventListener('click', () => {
  document.getElementById('inputText').value = '';
  document.getElementById('outputText').value = '';
  // üîÑ Vider √©galement le tableau de pr√©visualisation
document.getElementById('previewTable').innerHTML = '';
});

//lancement du nettoyage finale
document.getElementById('verif').addEventListener('click', () => {
  const outputEl = document.getElementById('outputText');
  const currentOutput = outputEl.value;

  if (!currentOutput.trim()) {
    alert("Aucun texte √† v√©rifier. Cliquez d'abord sur Nettoyer.");
    return;
  }

  const corrected = corrigerTriplets(currentOutput);
  outputEl.value = corrected;
  
  // üìä Appel de la fonction preview pour afficher le tableau en bas
  preview(corrected);
});

document.getElementById('btnClean').style.display = 'none';
document.getElementById('verif').style.display = 'none';

function corrigerTriplets(text) {
  let lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');
  let corrected = [];

  for (let i = 0; i < lines.length;) {
    const l1 = lines[i];
    const l2 = lines[i + 1];
    const l3 = lines[i + 2];

    // üîπ Cas sp√©cial : quantit√© maltrait√©e (ex: "-14 x" suivi de "0.25")
    if (l1 && l2 && /^-?\d+\s*[xX*]\s*$/.test(l1) && /^-?\d+[.,]?\d*$/.test(l2)) {
      corrected.push(l1.replace(/\s*[xX*]\s*$/i, '')); // quantit√© seulement
      i += 2;
      continue;
    }

    // üî∏ Cas 1 : produit + quantit√© + prix (triplet correct)
    if (l1 && l2 && l3 && /^-?\d+([.,]\d+)?$/.test(l2) && /^-?\d+([.,]\d+)?$/.test(l3)) {
      corrected.push(l1);
      corrected.push(l2);
      corrected.push(l3);
      i += 3;
      continue;
    }

    // üî∏ Cas 2 : produit + prix (quantit√© manquante)
    if (l1 && l2 && /^-?\d+([.,]\d+)?$/.test(l2)) {
      corrected.push(l1);
      corrected.push('1'); // quantit√© par d√©faut
      corrected.push(l2);
      i += 2;
      continue;
    }

    // üî∏ Cas 3 : ligne isol√©e
    corrected.push(l1);
    i += 1;
  }

  // üîß √âtape finale 1 : remplacer tous les espaces multiples par un seul espace
  let joined = corrected.join('\n').replace(/ {2,}/g, ' ');

  // üîß √âtape finale 2 : convertir les virgules en points pour les lignes purement num√©riques
  let finalLines = joined.split('\n').map(line => {
    // Si la ligne contient au moins une lettre, on la laisse telle quelle
    if (/[a-zA-Z]/.test(line)) return line;

    // Si la ligne est un nombre avec virgule (et sans lettres), on remplace la virgule par un point
    if (/^-?\d+,\d+$/.test(line)) {
      return line.replace(',', '.');
    }

    return line;
  });

  return finalLines.join('\n');
}


function preview(data) {
  table.innerHTML = ''; // üîÑ Nettoyer le tableau

  const lines = data.split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');

  let total = 0;
  let count = 0;

  // üßÆ Lire ligne par ligne par groupes de 3 (triplets)
  for (let i = 0; i < lines.length - 2; i += 3) {
    const prix = lines[i + 2];
    const prixFloat = parseFloat(prix.replace(',', '.'));
    if (!isNaN(prixFloat)) total += prixFloat;
    count++;
  }

  // ‚úÖ Mise √† jour du r√©sum√© dans le titre HTML
  const summaryHeader = document.getElementById('summaryHeader');
  summaryHeader.textContent = `üßæ Nombre des lignes: ${count} | Montant Total: ${total.toFixed(2)} ‚Ç¨`;

  // üß± Ajouter les en-t√™tes
  const header = table.insertRow();
  ['Items', 'Qty', 'Price'].forEach(text => {
    const th = document.createElement('th');
    th.textContent = text;
    header.appendChild(th);
  });

  // üîÑ Repasser pour ins√©rer les lignes
  for (let i = 0; i < lines.length - 2; i += 3) {
    const produit = lines[i];
    const quantite = lines[i + 1];
    const prix = lines[i + 2];

    const prixFloat = parseFloat(prix.replace(',', '.'));
    const isNegatif = !isNaN(prixFloat) && prixFloat < 0;

    const row = table.insertRow();

    const cellProduit = row.insertCell();
    cellProduit.textContent = produit;

    const cellQuantite = row.insertCell();
    cellQuantite.textContent = quantite;
    cellQuantite.style.textAlign = 'center';

    const cellPrix = row.insertCell();
    // ‚úÖ Toujours afficher avec 2 d√©cimales
    if (!isNaN(prixFloat)) {
      cellPrix.textContent = prixFloat.toFixed(2);
    } else {
      const fallbackFloat = parseFloat(prix.replace(',', '.'));
      cellPrix.textContent = !isNaN(fallbackFloat) ? fallbackFloat.toFixed(2) : "0.00";
    }
    cellPrix.style.textAlign = 'right';

    // üé® Mise en √©vidence si prix n√©gatif
    if (isNegatif) {
      const highlightColor = '#f8c6c6'; // rouge p√¢le
      [cellProduit, cellQuantite, cellPrix].forEach(cell => {
        cell.style.backgroundColor = highlightColor;
      });
    }
  }

  // ‚úÖ Ajouter l'√©couteur d'√©v√©nement pour copier le contenu des cellules
  table.addEventListener('click', function(event) {
    const target = event.target;
    if (target.tagName.toLowerCase() !== 'td') return;

    const row = target.parentElement;
    if (row.rowIndex === 0 || row.rowIndex === 1) return;

    const text = target.textContent;
    if (!text) return;

    navigator.clipboard.writeText(text).then(() => {
      const originalColor = target.style.backgroundColor || 'transparent';
      target.style.transition = 'background-color 0.3s ease';
      target.style.backgroundColor = '#ffe066'; // jaune fonc√© doux
      setTimeout(() => {
        target.style.backgroundColor = originalColor;
      }, 1200);
    }).catch(err => {
      console.error('Erreur de copie :', err);
    });
  });
}


// üéØ Ajout de raccourcis clavier Ctrl+Alt+1 = Nettoyer, Ctrl+Alt+2 = V√©rifier
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey && e.altKey && e.key === '1') {
    e.preventDefault(); // ‚õî Emp√™che tout comportement par d√©faut
    document.getElementById('btnClean').click();
  }
  if (e.ctrlKey && e.altKey && e.key === '2') {
    e.preventDefault(); // ‚õî Emp√™che tout comportement par d√©faut
    document.getElementById('verif').click();
  }
});



//AJUSTEMENT RAPIDE POUR LA MISE EN page
document.addEventListener('keydown', function (e) {
  if (!e.ctrlKey || !e.altKey) return;

  const textarea = document.getElementById('inputText');
  const pos = textarea.selectionStart;

  if (textarea !== document.activeElement) return; // S'assure que le focus est sur le textarea

  const text = textarea.value;

  // Trouver les espaces √† gauche
  let left = pos - 1;
  while (left >= 0 && text[left] === ' ') {
    left--;
  }

  // Trouver les espaces √† droite
  let right = pos;
  while (right < text.length && text[right] === ' ') {
    right++;
  }

  const totalSpaces = right - (left + 1);

  if (totalSpaces <= 0) return; // Rien √† faire si 0 ou 1 espace

  // D√©terminer combien d'espaces on veut ins√©rer
  let newSpaces;
  if (e.key.toLowerCase() === 'd') {
    newSpaces = ' '.repeat(10); // Ctrl+Alt+D => 6 espaces
  } else if (e.key.toLowerCase() === 'c') {
    newSpaces = ' '.repeat(1); // Ctrl+Alt+C => 2 espaces
  } else {
    return; // autre touche => on ne fait rien
  }

  // Remplacement
  const before = text.substring(0, left + 1);
  const after = text.substring(right);
  const newCursorPos = before.length + newSpaces.length;

  textarea.value = before + newSpaces + after;

  // Repositionner le curseur juste apr√®s les nouveaux espaces
  textarea.setSelectionRange(newCursorPos, newCursorPos);
  e.preventDefault(); // √©viter le comportement par d√©faut du navigateur
});


// üìã Gestion du bouton "Copier"
document.getElementById('copyresult').addEventListener('click', () => {
  const output = document.getElementById('outputText');
  const data = output.value.trim();

  if (!data) {
    alert("Aucune donn√©e √† copier.");
    return;
  }

  // Copier dans le presse-papiers
  navigator.clipboard.writeText(data).then(() => {
    showNotification("Donn√©es bien copi√©es !");
  });
});

// üîî Fonction pour afficher une notification temporaire
function showNotification(message) {
  let notif = document.createElement('div');
  notif.textContent = message;
  notif.style.position = 'fixed';
  notif.style.top = '10px';             // ‚¨ÜÔ∏è En haut
  notif.style.right = '20px';           // üìç √Ä droite
  notif.style.backgroundColor = '#4CAF50';
  notif.style.color = 'white';
  notif.style.padding = '10px 20px';
  notif.style.borderRadius = '5px';
  notif.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
  notif.style.zIndex = '1000';
  notif.style.fontWeight = 'bold';      // üî† Bien visible
  notif.style.fontSize = '14px';        // üîé L√©g√®rement agrandi
  document.body.appendChild(notif);

  setTimeout(() => {
    notif.remove();
  }, 3000);
}

function setWidths(showLeft, showRight) {
  if (showLeft && showRight) {
    // Affichage en mode 50/50
    inputText.style.display = 'block';
    linePreview.style.display = 'none';
    previewTable.style.display = 'table';

    inputText.style.width = '50%';
    linePreview.style.width = '50%';
    previewTable.style.width = '50%';
  } else if (showRight) {
    // Affichage uniquement de la zone de texte (textarea + div linePreview)
    inputText.style.display = 'block';
    linePreview.style.display = 'none';
    previewTable.style.display = 'none';

    inputText.style.width = '100%';
    linePreview.style.width = '100%';
  } else if (showLeft) {
    // Affichage uniquement du tableau
    inputText.style.display = 'none';
    linePreview.style.display = 'none';
    previewTable.style.display = 'table';

    previewTable.style.width = '100%';
  }
}

// √âv√©nements des boutons
document.getElementById('leftExpand').addEventListener('click', () => {
  setWidths(false, true); // <  ‚Üí seulement le tableau
});

document.getElementById('equalSplit').addEventListener('click', () => {
  setWidths(true, true);  // |  ‚Üí 50/50
});

document.getElementById('rightExpand').addEventListener('click', () => {
  setWidths(true, false); // >  ‚Üí seulement la zone de texte
});

function resizeHeights() {
  const controlsBottom = document.getElementById('resizeControls').getBoundingClientRect().bottom;
  const availableHeight = window.innerHeight - controlsBottom - 10;
  container.style.height = availableHeight + 'px';

  linePreview.style.height = '100%';
  table.style.height = '100%';
}

  window.addEventListener('load', resizeHeights);
  window.addEventListener('resize', resizeHeights);



window.onload = function () {
    const textarea = document.getElementById('inputText');
    const preview = document.getElementById('linePreview');

    if (!textarea || !preview) return;

    function updateLinePreview() {
      const lines = textarea.value.split('\n');
      const html = lines.map(line => {
        const content = line === '' ? '‚ê§' : line;
        return `<span class="linebreak">${content}</span>`;
      }).join('');
      preview.innerHTML = html;

      // Recalcule la position
      const rect = textarea.getBoundingClientRect();
      preview.style.top = rect.top + window.scrollY + 'px';
      preview.style.left = rect.left + window.scrollX + 'px';
      preview.style.width = rect.width + 'px';
      preview.style.height = rect.height + 'px';
    }

    textarea.addEventListener('input', updateLinePreview);
    window.addEventListener('resize', updateLinePreview);
    window.addEventListener('scroll', updateLinePreview);

    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key.toLowerCase() === 'l') {
        e.preventDefault();
        preview.style.display = preview.style.display === 'none' ? 'block' : 'none';
        if (preview.style.display === 'block') updateLinePreview();
      }
    });
  };


// Synchroniser le scroll de linePreview avec inputText
inputText.addEventListener('scroll', () => {
  linePreview.scrollTop = inputText.scrollTop;
  linePreview.scrollLeft = inputText.scrollLeft;
});

function updateLinePreviewVisuals() {
  const preview = document.getElementById('linePreview');
  const text = preview.innerText; // On garde le texte original depuis le div
  const lines = text.split(/\r?\n/);

  const selection = window.getSelection();
  const range = selection.getRangeAt(0);
  const startOffset = range.startOffset;

  // On ne reconstruit que si le texte change
  const html = lines.map(line => {
    const safe = line.replace(/</g, "&lt;").replace(/>/g, "&gt;");
    return `<span class="linebreak">${safe}</span>`;
  }).join('');

  // Ne reconstruire que si c'est n√©cessaire
  if (preview.dataset.lastContent !== html) {
    preview.innerHTML = html;
    preview.dataset.lastContent = html;

    // Restaurer la position du curseur
    placeCursorAtEnd(preview, startOffset);
  }
}


function placeCursorAtEnd(el, offset = null) {
  el.focus();

  const range = document.createRange();
  const sel = window.getSelection();

  // Trouver le dernier span ou texte
  const lastNode = el.lastChild;
  if (lastNode) {
    const textNode = lastNode.firstChild || lastNode;
    const length = offset !== null ? offset : (textNode.length || 0);
    range.setStart(textNode, Math.min(length, textNode.length));
    range.collapse(true);
    sel.removeAllRanges();
    sel.addRange(range);
  }
}


document.getElementById('rightExpand').addEventListener('click', () => {
  setWidths(true, false); // >  ‚Üí seulement la zone de texte
  document.getElementById('btnClean').click(); // üëà Simule le clic sur Nettoyer
});


</script>

</body>
</html>
